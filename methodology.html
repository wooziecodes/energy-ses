<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENERGY-SES: Methodology</title>
    <link rel="stylesheet" href="css/template.css">
    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <style>
        /* Maintaining consistent styling with literature page */
        .methodology-content {
            background: var(--section-bg);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .method-section {
            margin-bottom: 3rem;
        }

        /* Code block styling */
        .code-block {
            background: #f8f9fa;
            border-radius: 8px;
            margin: 1.5rem 0;
            position: relative;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: #e9ecef;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #dee2e6;
        }

        .code-title {
            font-weight: 500;
            color: #495057;
        }

        .copy-button {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.75rem;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .copy-button:hover {
            background: #5a6268;
        }

        .code-content {
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        /* Figure styling */
        .figure-container {
            margin: 2rem 0;
            text-align: center;
        }

        .figure-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .figure-caption {
            margin-top: 1rem;
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Expandable sections */
        .expandable-section {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .expandable-header {
            padding: 1rem;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expandable-content {
            padding: 1rem;
            display: none;
        }

        .expandable-content.active {
            display: block;
        }

        /* Process steps */
        .process-step {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .step-number {
            color: var(--accent-color);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .overview-box {
            background: #f8f9fa;
            border-left: 4px solid var(--accent-color);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .note-text {
            font-style: italic;
            color: #666;
            margin: 1rem 0;
        }

        .data-source-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .data-source-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .alpha-note {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            font-weight: 500;
        }

        .methodology-pivot {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .overview-box {
            background: #f8f9fa;
            border-left: 4px solid var(--accent-color);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .note-text {
            font-style: italic;
            color: #666;
            margin: 1rem 0;
        }

        .data-source-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .data-source-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .alpha-note {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            font-weight: 500;
        }

        .methodology-pivot {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="container hero">
            <h1>ENERGY-SES</h1>
            <p>Socioeconomic Patterns in London's Energy Consumption</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="introduction.html">Introduction</a></li>
                <li><a href="literature.html">Literature Review</a></li>
                <li><a href="methodology.html" class="active">Methodology</a></li>
                <li><a href="visualization.html">Visualisation</a></li>
                <li><a href="findings.html">Findings</a></li>
                <li><a href="discussion.html">Discussion</a></li>
                <li><a href="implications.html">Implications & Conclusions</a></li>
                <li><a href="bibliography.html">Bibliography</a></li>
                <li><a href="profiles.html">Our Profiles</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="container">
            <div class="methodology-content">
                <!-- Overview Section -->
                <section class="methodology-section" id="overview">
                    <h2>Overview</h2>
                    <div class="overview-box">
                        <p>The aim was to construct and evaluate a borough-level normal linear regression model of mean household energy consumption (measured in kWh per meter) according to median income of taxpayers, mean domestic energy efficiency rating, mean people per household.</p>
                        <p>This regression model would facilitate measuring the effect of changes in median income of taxpayers on the mean household energy consumption, while controlling for mean domestic energy efficiency ratings and mean people per household.</p>
                    </div>

                    <div class="methodology-pivot">
                        <p>As explained later, under the heading 'assessing electricity data', we decided to pivot our research question to focus only on gas consumption, because the electricity data were not suitable for a rigorous regression analysis within our skillset. In the sections that follow we will discuss other methodological challenges we encountered throughout the analysis, and how we worked to overcome these.</p>
                    </div>

                    <div class="alpha-note">
                        Alpha is set at the conventional level of 0.05 for all statistical tests in this analysis.
                    </div>

                    <div class="step-container">
                        <h3>Variables</h3>
                        <ul class="variable-list">
                            <li>Mean domestic gas consumption (kWh per meter) (over the year) - 2023</li>
                            <li>Mean domestic electricity consumption (kWh per meter) (over the year) - 2023</li>
                            <li>Median Personal incomes of taxpayers (before tax) (GBP) (over the year) - 2021/22</li>
                            <li>Estimated mean people per household - 2021</li>
                            <li>Estimated mean domestic energy efficiency rating (1-100 rating) - 2021</li>
                        </ul>
                        <p class="note-text">Note that 'meter' refers to an energy meter, not a measure of distance.</p>
                    </div>
                </section>

                <!-- Data Sources Section -->
                <section class="methodology-section" id="data-sources">
                    <h2>Data Sources</h2>
                    <div class="data-sources-grid">
                        <div class="data-source-card">
                            <h4>Department for Energy Security and Net Zero (2024)</h4>
                            <p>Domestic gas consumption</p>
                        </div>
                        <div class="data-source-card">
                            <h4>Department for Energy Security and Net Zero (2024a)</h4>
                            <p>Domestic electricity consumption</p>
                        </div>
                        <div class="data-source-card">
                            <h4>Greater London Authority (2024)</h4>
                            <p>Personal incomes of taxpayers</p>
                        </div>
                        <div class="data-source-card">
                            <h4>Office for National Statistics (ONS) (2024a)</h4>
                            <p>People per household</p>
                        </div>
                        <div class="data-source-card">
                            <h4>Ministry of Housing, Communities & Local Government (MHCLG) (2021)</h4>
                            <p>Domestic energy efficiency ratings</p>
                        </div>
                    </div>

                    <div class="data-note">
                        <p>Borough level data was used because household level data are not available for all relevant variables. This means that we are considering average values for each borough for each of the variables.</p>
                    </div>
                </section>

                <!-- Rest of the sections will be implemented in subsequent updates -->

            </div>
        </div>
    </main>


     
                <!-- Data Wrangling Section -->
                <section class="methodology-section" id="data-wrangling">
                    <h2>Data Wrangling and Cleaning</h2>
                    
                    <div class="process-overview">
                        <p>All coding was done in Google Colab. Data files were downloaded from government websites, and opened as MS Excel files. For each data file, some preprocessing was carried out in Excel, including selecting only the spreadsheet with the most recent year, and selecting only data from London boroughs. The files were then uploaded to Google Drive and mounted into the Colab page.</p>
                    </div>

                    <div class="step-container">
                        <h3>Common Data Cleaning Steps</h3>
                        <p>For each of the 5 datasets, the data were cleaned in order to eventually be merged into a single dataframe. The common data cleaning included the following:</p>
                        <ol class="cleaning-steps">
                            <li>Removal of excess rows containing headings or other information (from Excel layout)</li>
                            <li>Changing column names (for ease of understanding, and to match between dfs so that merge can take place)</li>
                            <li>Removing columns of excess data not being used in analysis</li>
                            <li>Resetting index</li>
                            <li>Removal of commas and making all values numeric</li>
                        </ol>
                        <p class="note-text">There were no missing data in any of the datasets.</p>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-header">
                            <h4>Example Code: Gas Consumption Data Cleaning</h4>
                            <span class="toggle-icon">▼</span>
                        </div>
                        <div class="expandable-content">
                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-title">gas_data_cleaning.py</span>
                                    <button class="copy-button">Copy</button>
                                </div>
                                <div class="code-content">
                                    <pre><code class="language-python"># reading in gas data from google drive
gas = pd.read_csv('/content/drive/MyDrive/FINALQM2/filtered_gas_consumption_2022.csv')

#cleaning gas dataframe
# rename local authority as 'Area' to match other dfs
gas = gas.rename(columns={'Local authority':'Area'})

# add index
gas = gas.reset_index(drop=True)

# drop excess columns
gas = gas.drop(columns=['Code', 'Country or region', 'Notes'])

# rename columns
gas = gas.rename(columns={
    'Total consumption\n(GWh):\nDomestic\n': 'GAS Total domestic consumption (GWh)',
    'Mean consumption\n(kWh per meter):\nDomestic\n': 'GAS Mean domestic consumption (kWh per meter)',
    'Median consumption\n(kWh per meter):\nDomestic\n': 'GAS Median domestic consumption (kWh per meter)'
})

# Remove commas from all columns with string types (which should be numeric)
cols_commas = ['GAS Total domestic consumption (GWh)', 
               'GAS Mean domestic consumption (kWh per meter)', 
               'GAS Median domestic consumption (kWh per meter)']

for col in cols_commas:
    if gas[col].dtype == object:  # Check if column is of object type
        gas[col] = gas[col].str.replace(',', '')

# Convert to numeric after removing commas
for col in cols_commas:
    gas[col] = pd.to_numeric(gas[col], errors='coerce').fillna(0)</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-container">
                        <h3>Calculating Estimated Means</h3>
                        <div class="calculation-section">
                            <h4>Estimated Mean People per Household</h4>
                            <ul class="process-steps">
                                <li>Household size data was given as number of households in each borough with 1,2,3,4 or 5+ members</li>
                                <li>For each borough we needed the average number of people per household using the United States Census Bureau (2020) method: calculating a weighted mean from the distribution of household sizes</li>
                                <li>We calculated an estimate of the total people in all households by multiplying the number of households in each size category by the household size (using 5.5 for 5+ households)</li>
                                <li>Total households were calculated by summing the number of households in each size category</li>
                                <li>Final calculation divided total people by total households</li>
                            </ul>
                        </div>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-header">
                            <h4>Code: Calculating Mean People per Household</h4>
                            <span class="toggle-icon">▼</span>
                        </div>
                        <div class="expandable-content">
                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-title">household_calculations.py</span>
                                    <button class="copy-button">Copy</button>
                                </div>
                                <div class="code-content">
                                    <pre><code class="language-python"># Calculate and add 'mean people per household' column
people_per_household['mean people per household'] = 0

for index in people_per_household.index:
    # Calculate total number of people per borough
    total_people = (
        1 * people_per_household.loc[index, 'households with 1 person'] +
        2 * people_per_household.loc[index, 'households with 2 people'] +
        3 * people_per_household.loc[index, 'households with 3 people'] +
        4 * people_per_household.loc[index, 'households with 4 people'] +
        5.5 * people_per_household.loc[index, 'households with 5+ people']  # 5.5 used for 5+ people households
    )
    
    # Calculate total number of households per borough
    total_households = (
        people_per_household.loc[index, 'households with 1 person'] +
        people_per_household.loc[index, 'households with 2 people'] +
        people_per_household.loc[index, 'households with 3 people'] +
        people_per_household.loc[index, 'households with 4 people'] +
        people_per_household.loc[index, 'households with 5+ people']
    )
    
    # Calculate mean by dividing total people by total households
    if total_households != 0:
        people_per_household.loc[index, 'mean people per household'] = total_people / total_households</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-container">
                        <h3>Energy Efficiency Ratings Calculation</h3>
                        <div class="calculation-section">
                            <h4>Calculating Estimated Mean Domestic Energy Efficiency Rating</h4>
                            <ul class="process-steps">
                                <li>Data provided as number of households in each borough with ratings of A,B,C,D,E,F or G</li>
                                <li>Categories represent intervals: A = 92-100, B = 81-91, C = 69-80, D = 55-68, E = 39-54, F = 21-38, G = 1-20</li>
                                <li>Calculated weighted mean by multiplying households in each category by the mean score of that category</li>
                                <li>Total households calculated by summing all categories</li>
                                <li>Mean calculated as total estimated ratings divided by total households</li>
                            </ul>
                        </div>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-header">
                            <h4>Code: Energy Efficiency Rating Calculations</h4>
                            <span class="toggle-icon">▼</span>
                        </div>
                        <div class="expandable-content">
                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-title">energy_rating_calculations.py</span>
                                    <button class="copy-button">Copy</button>
                                </div>
                                <div class="code-content">
                                    <pre><code class="language-python"># Add 'estimated mean dwelling energy rating' column and initialize with 0
energy_rating['estimated mean dwelling energy rating'] = 0

for index in energy_rating.index:
    # Calculate total energy ratings
    total_ratings = (
        ((92+100)/2) * energy_rating.loc[index,'A:92+'] +
        ((81+91)/2) * energy_rating.loc[index,'B:81-91'] +
        ((69+80)/2) * energy_rating.loc[index,'C:69-80'] +
        ((55+68)/2) * energy_rating.loc[index,'D:55-68'] +
        ((39+54)/2) * energy_rating.loc[index,'E:39-54'] +
        ((21+38)/2) * energy_rating.loc[index,'F:21-38'] +
        ((1+20)/2) * energy_rating.loc[index,'G:1-20']
    )

    # Calculate total dwellings
    total_dwellings = (
        energy_rating.loc[index, 'A:92+'] +
        energy_rating.loc[index, 'B:81-91'] +
        energy_rating.loc[index, 'C:69-80'] +
        energy_rating.loc[index, 'D:55-68'] +
        energy_rating.loc[index, 'E:39-54'] +
        energy_rating.loc[index, 'F:21-38'] +
        energy_rating.loc[index, 'G:1-20']
    )

    # Calculate estimated mean dwelling energy rating
    if total_dwellings != 0:
        energy_rating.loc[index, 'estimated mean dwelling energy rating'] = total_ratings / total_dwellings</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-container">
                        <h3>Final Data Merging</h3>
                        <p>The final step of data wrangling was merging the 5 dataframes into one. This was done by merging on the column 'Area' which contains the London borough names:</p>
                        
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-title">merge_dataframes.py</span>
                                <button class="copy-button">Copy</button>
                            </div>
                            <div class="code-content">
                                <pre><code class="language-python"># Merge the dataframes
merged_df = pd.merge(people_per_household, energy_rating, on='Area', how='inner')
merged_df = pd.merge(merged_df, median_income, on='Area', how='inner')
merged_df = pd.merge(merged_df, electricity, on='Area', how='inner')
merged_df = pd.merge(merged_df, gas, on='Area', how='inner')</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="methodology-section" id="statistical-analysis">
                    <h2>Statistical Analysis</h2>
                
                    <style>
                        /* New styles for statistical elements */
                        .stat-plot {
                            background: white;
                            padding: 1.5rem;
                            border-radius: 8px;
                            margin: 1.5rem 0;
                            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                        }
                
                        .stat-plot img {
                            max-width: 100%;
                            height: auto;
                        }
                
                        .test-result {
                            background: #f8f9fa;
                            border-left: 4px solid #4caf50;
                            padding: 1rem;
                            margin: 1rem 0;
                            font-family: monospace;
                        }
                
                        .assumption-box {
                            background: #fff;
                            border: 1px solid #dee2e6;
                            border-radius: 8px;
                            padding: 1.5rem;
                            margin: 1.5rem 0;
                        }
                
                        .assumption-box h4 {
                            color: var(--accent-color);
                            margin-bottom: 1rem;
                        }
                
                        .transformation-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                            gap: 1.5rem;
                            margin: 1.5rem 0;
                        }
                
                        .vif-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 1rem 0;
                            background: white;
                        }
                
                        .vif-table th, .vif-table td {
                            padding: 0.75rem;
                            border: 1px solid #dee2e6;
                            text-align: left;
                        }
                
                        .vif-table th {
                            background: #f8f9fa;
                        }
                    </style>
                
                    <!-- Thinking About Assumptions -->
                    <div class="assumption-box">
                        <h4>Model Assumptions</h4>
                        <p>We intended to construct two normal linear ordinary least squares regression models for energy consumption - one with electricity consumption as the response and the other with gas consumption as the response. For both models the covariates would be median income, mean dwelling energy efficiency and mean people per household.</p>
                        <ul class="assumption-list">
                            <li>1. Linearity</li>
                            <li>2. Normality of the errors</li>
                            <li>3. Homoscedasticity of the errors</li>
                            <li>4. Independence of the errors</li>
                        </ul>
                    </div>
                
                    <!-- Electricity Data Analysis -->
                    <div class="expandable-section">
                        <div class="expandable-header">
                            <h4>Assessing Distribution of Electricity Consumption Data</h4>
                            <span class="toggle-icon">▼</span>
                        </div>
                        <div class="expandable-content">
                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-title">electricity_transformations.py</span>
                                    <button class="copy-button">Copy</button>
                                </div>
                                <div class="code-content">
                                    <pre><code class="language-python"># Square Root Transformation
                df_without_CoL['sqrt_elec_mean'] = np.sqrt(df_without_CoL['ELEC Mean domestic consumption (kWh per meter)'])
                
                # Log Transformation
                df_without_CoL['log_elec_mean'] = np.log(df_without_CoL['ELEC Mean domestic consumption (kWh per meter)'])
                
                # Box-Cox Transformation
                transformed_data, lambda_value = stats.boxcox(df_without_CoL['ELEC Mean domestic consumption (kWh per meter)'])
                df_without_CoL['boxcox_elec_mean'] = transformed_data</code></pre>
                                </div>
                            </div>
                
                            <div class="stat-plot">
                                <img src="/api/placeholder/800/400" alt="Transformation Comparison Plots">
                                <p class="plot-caption">Comparison of different transformations on electricity consumption data</p>
                            </div>
                        </div>
                    </div>
                
                    <!-- Gas Data Analysis -->
                    <div class="test-result">
                        <h4>Shapiro-Wilk Test Results (Gas Consumption)</h4>
                        <pre>Statistic: 0.9838021729156037
                P-value: 0.9150817848543163
                
                The p-value (0.9151) is greater than 0.05, therefore we fail to reject the null hypothesis of normality.</pre>
                    </div>
                
                    <!-- VIF Analysis -->
                    <div class="assumption-box">
                        <h4>Variance Inflation Factor (VIF) Analysis</h4>
                        <p>VIF of 5 or more suggests multicollinearity is present, and VIFs above ten indicate serious collinearity (Kim, 2019).</p>
                        
                        <table class="vif-table">
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>VIF</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Median income</td>
                                    <td>122.145741</td>
                                </tr>
                                <tr>
                                    <td>Mean people per household</td>
                                    <td>183.174208</td>
                                </tr>
                                <tr>
                                    <td>Estimated mean dwelling energy rating</td>
                                    <td>499.896117</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                
                    <!-- Final Model Construction -->
                    <div class="expandable-section">
                        <div class="expandable-header">
                            <h4>Final Model Construction</h4>
                            <span class="toggle-icon">▼</span>
                        </div>
                        <div class="expandable-content">
                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-title">final_model.py</span>
                                    <button class="copy-button">Copy</button>
                                </div>
                                <div class="code-content">
                                    <pre><code class="language-python"># Define the formula for the multiple linear regression model
                formula = 'Q("GAS Mean domestic consumption (kWh per meter)") ~ Median_Income_Centered + Mean_People_Centered + Q("estimated mean dwelling energy rating") + Median_Income_Centered*Mean_People_Centered + Q("estimated mean dwelling energy rating")*Median_Income_Centered'
                
                model = smf.ols(formula=formula, data=df_without_CoL).fit()
                print(model.summary())</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- <!DOCTYPE html>
                <html lang="en"> -->


            </div>
        </div>
    </main>

 

    <footer>
        <div class="container">
            <p>© 2024 ENERGY-SES Project • QM2 Group XX</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        // Expandable sections
        document.querySelectorAll('.expandable-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                content.classList.toggle('active');
                const icon = header.querySelector('.toggle-icon');
                icon.textContent = content.classList.contains('active') ? '▼' : '▶';
            });
        });

        // Copy button functionality
        document.querySelectorAll('.copy-button').forEach(button => {
            button.addEventListener('click', () => {
                const codeBlock = button.closest('.code-block');
                const code = codeBlock.querySelector('code').textContent;
                navigator.clipboard.writeText(code);
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        });
    </script>
</body>
</html>


